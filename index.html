<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Mine City - Image System (Direct Update)</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; background-color: #1a1a1a; color: white; margin: 0; padding: 20px; }
        .card { background-color: #2d2d2d; padding: 2.5rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); text-align: center; width: 420px; }
        h2 { color: #4CAF50; margin-bottom: 5px; }
        .sub-title { color: #aaa; font-size: 0.9rem; margin-bottom: 25px; }
        .section { background: #232323; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #333; text-align: left; }
        .section h3 { font-size: 0.95rem; margin-top: 0; color: #4CAF50; border-bottom: 1px solid #444; padding-bottom: 8px; margin-bottom: 12px; }
        label { display: block; font-size: 0.8rem; color: #888; margin-bottom: 5px; }
        input[type="text"] { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #444; background: #111; color: white; box-sizing: border-box; margin-bottom: 10px; font-size: 0.9rem; }
        input[type="file"] { margin: 5px 0 15px 0; width: 100%; color: #bbb; font-size: 0.85rem; }
        button { border: none; padding: 12px; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; font-size: 0.95rem; transition: 0.3s; margin-top: 5px; }
        .btn-normal { background-color: #607D8B; color: white; }
        .btn-auto { background-color: #4CAF50; color: white; }
        #result-container { margin-top: 20px; display: none; padding: 15px; background: #3d3d3d; border-radius: 10px; border: 1px solid #555; }
        #id-display { font-size: 1.4rem; color: #ffd700; font-weight: bold; display: block; margin-bottom: 10px; letter-spacing: 2px; }
        .btn-copy { background-color: #2196F3; color: white; padding: 6px 12px; width: auto; font-size: 0.8rem; }
        .status-msg { font-size: 0.8rem; color: #888; margin-top: 15px; }
    </style>
</head>
<body>
    <div class="card">
        <h2>üì± Mine City</h2>
        <p class="sub-title">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏π‡∏õ‡∏ï‡∏¥‡∏î‡∏ö‡∏±‡∏ï‡∏£ [ ‡∏â‡∏ö‡∏±‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ï‡∏£‡∏á Firebase ]</p>
        
        <div class="section">
            <h3>[ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏≤‡∏£‡∏´‡∏±‡∏™ ID ]</h3>
            <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û:</label>
            <input type="file" id="fileNormal" accept="image/*">
            <button class="btn-normal" onclick="handleUpload('normal')">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏≤‡∏£‡∏´‡∏±‡∏™ ID</button>
        </div>

        <div class="section">
            <h3>[ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏π‡∏õ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ]</h3>
            <label>RobloxID (‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•):</label>
            <input type="text" id="robloxIdInput" placeholder="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: 9232519691" value="9232519691">
            <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏°‡πà:</label>
            <input type="file" id="fileAuto" accept="image/*">
            <button class="btn-auto" onclick="handleUpload('auto')">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏π‡∏õ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏±‡∏ï‡∏£‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</button>
        </div>

        <div id="result-container">
            <span id="id-display">‡∏£‡∏´‡∏±‡∏™‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</span>
            <button class="btn-copy" id="copyBtn" onclick="copyId()">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™</button>
        </div>
        
        <p class="status-msg" id="status-text">Server Status: Online ‚úÖ</p>
    </div>

    <script>
        // --- üîí ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase (URL ‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì) ---
        const firebaseConfig = {
            databaseURL: "https://minecityimages-default-rtdb.asia-southeast1.firebasedatabase.app/"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        async function handleUpload(type) {
            const statusText = document.getElementById('status-text');
            const resultContainer = document.getElementById('result-container');
            const idDisplay = document.getElementById('id-display');
            
            let fileInput = (type === 'normal') ? document.getElementById('fileNormal') : document.getElementById('fileAuto');
            let robloxId = document.getElementById('robloxIdInput').value.trim();

            if (fileInput.files.length === 0) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö!");
                return;
            }

            idDisplay.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...";
            resultContainer.style.display = "block";
            statusText.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Render...";

            const formData = new FormData();
            formData.append('image', fileInput.files[0]);

            try {
                // 1. ‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡πÑ‡∏õ‡πÉ‡∏´‡πâ Render ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏û‡∏¥‡∏Å‡πÄ‡∏ã‡∏•
                const response = await fetch('https://mine-city.onrender.com/upload', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                
                if (data.id) {
                    const newImageId = data.id;
                    idDisplay.innerText = newImageId;

                    if (type === 'auto') {
                        statusText.innerText = "‚åõ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏±‡πà‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Firebase ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á...";
                        
                        // 2. üöÄ ‡∏™‡∏±‡πà‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á RobloxID ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                        database.ref('UsersID/' + robloxId).update({
                            "ImageURL": newImageId
                        }).then(() => {
                            statusText.innerText = "‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï ImageURL ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!";
                            alert("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô Firebase ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô: " + newImageId);
                        }).catch((err) => {
                            statusText.innerText = "‚ùå Firebase Error: " + err.message;
                            console.error(err);
                        });
                    } else {
                        statusText.innerText = "‚úÖ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!";
                    }
                }
            } catch (error) {
                statusText.innerText = "‚ùå ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ Server ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ";
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ Render ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà");
            }
        }

        function copyId() {
            const text = document.getElementById('id-display').innerText;
            navigator.clipboard.writeText(text).then(() => alert("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!"));
        }
    </script>
</body>
</html>
