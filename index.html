<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Mine City - Image System (Direct Update)</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; background-color: #1a1a1a; color: white; margin: 0; padding: 20px; }
        .card { background-color: #2d2d2d; padding: 2.5rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); text-align: center; width: 420px; }
        h2 { color: #4CAF50; margin-bottom: 5px; }
        .sub-title { color: #aaa; font-size: 0.9rem; margin-bottom: 25px; }
        .section { background: #232323; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #333; text-align: left; }
        .section h3 { font-size: 0.95rem; margin-top: 0; color: #4CAF50; border-bottom: 1px solid #444; padding-bottom: 8px; margin-bottom: 12px; }
        label { display: block; font-size: 0.8rem; color: #888; margin-bottom: 5px; }
        input[type="text"] { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #444; background: #111; color: white; box-sizing: border-box; margin-bottom: 10px; font-size: 0.9rem; }
        input[type="file"] { margin: 5px 0 15px 0; width: 100%; color: #bbb; font-size: 0.85rem; }
        button { border: none; padding: 12px; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; font-size: 0.95rem; transition: 0.3s; margin-top: 5px; }
        .btn-normal { background-color: #607D8B; color: white; }
        .btn-auto { background-color: #4CAF50; color: white; }
        #result-container { margin-top: 20px; display: none; padding: 15px; background: #3d3d3d; border-radius: 10px; border: 1px solid #555; }
        #id-display { font-size: 1.4rem; color: #ffd700; font-weight: bold; display: block; margin-bottom: 10px; letter-spacing: 2px; }
        .btn-copy { background-color: #2196F3; color: white; padding: 6px 12px; width: auto; font-size: 0.8rem; }
        .status-msg { font-size: 0.8rem; color: #888; margin-top: 15px; }
    </style>
</head>
<body>
    <div class="card">
        <h2>üì± Mine City</h2>
        <p class="sub-title">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏π‡∏õ‡∏ï‡∏¥‡∏î‡∏ö‡∏±‡∏ï‡∏£ [ ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î 1:1 ]</p>
        
        <div class="section">
            <h3>[ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ‡∏ó‡∏≥‡∏ö‡∏±‡∏ï‡∏£‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ]</h3>
            <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û:</label>
            <input type="file" id="fileNormal" accept="image/*">
            <button class="btn-normal" onclick="handleUpload('normal')">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î</button>
        </div>

        <div class="section">
            <h3>[ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏π‡∏õ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏ö‡∏±‡∏ï‡∏£‡πÅ‡∏•‡πâ‡∏ß ]</h3>
            <label>No.ID ( No. ‡πÉ‡∏ï‡πâ‡∏ö‡∏±‡∏ï‡∏£ )</label>
            <input type="text" id="robloxIdInput" placeholder="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: 9232519691">
            <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏°‡πà:</label>
            <input type="file" id="fileAuto" accept="image/*">
            <button class="btn-auto" onclick="handleUpload('auto')">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏π‡∏õ</button>
        </div>

        <div id="result-container">
            <span id="id-display">‡∏£‡∏´‡∏±‡∏™‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</span>
            <button class="btn-copy" id="copyBtn" onclick="copyId()">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™</button>
        </div>
        
        <p class="status-msg" id="status-text">Server Status: Online ‚úÖ</p>
    </div>

    <script>
        // --- üîí ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase (‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì) ---
        const firebaseConfig = {
            databaseURL: "https://minecityimages-default-rtdb.asia-southeast1.firebasedatabase.app/"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        async function handleUpload(type) {
            const statusText = document.getElementById('status-text');
            const resultContainer = document.getElementById('result-container');
            const idDisplay = document.getElementById('id-display');
            
            let fileInput = (type === 'normal') ? document.getElementById('fileNormal') : document.getElementById('fileAuto');
            let robloxId = document.getElementById('robloxIdInput').value.trim();

            if (fileInput.files.length === 0) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö!");
                return;
            }

            idDisplay.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...";
            resultContainer.style.display = "block";
            statusText.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏û‡∏¥‡∏Å‡πÄ‡∏ã‡∏•‡πÑ‡∏õ‡∏ó‡∏µ‡πà Render...";

            const formData = new FormData();
            formData.append('image', fileInput.files[0]);

            try {
                // 1. ‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡πÑ‡∏õ‡πÉ‡∏´‡πâ Render ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏û‡∏¥‡∏Å‡πÄ‡∏ã‡∏• 50x50
                const response = await fetch('https://mine-city.onrender.com/upload', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                
                if (data.id) {
                    const newImageId = data.id;
                    idDisplay.innerText = newImageId;

                    if (type === 'auto') {
                        if (!robloxId) {
                            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å No.ID (RobloxID) ‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏£‡∏±‡∏ö!");
                            return;
                        }
                        
                        statusText.innerText = "‚åõ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡πà‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤ Firebase...";
                        
                        // 2. üöÄ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï ImageURL ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á UsersID/[RobloxID] ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                        database.ref('UsersID/' + robloxId).update({
                            "ImageURL": newImageId
                        }).then(() => {
                            statusText.innerText = "‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!";
                            alert("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ID: " + robloxId + " ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
                        }).catch((err) => {
                            statusText.innerText = "‚ùå Firebase Error: " + err.message;
                            console.error(err);
                        });
                    } else {
                        statusText.innerText = "‚úÖ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡πÇ‡∏õ‡∏£‡∏î‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏û‡∏¥‡∏Å‡πÄ‡∏ã‡∏•";
                    }
                }
            } catch (error) {
                statusText.innerText = "‚ùå ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Render";
                alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ Server ‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á");
            }
        }

        function copyId() {
            const text = document.getElementById('id-display').innerText;
            navigator.clipboard.writeText(text).then(() => alert("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ " + text + " ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!"));
        }
    </script>
</body>
</html>
