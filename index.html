<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Mine City - Image System</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; background-color: #1a1a1a; color: white; margin: 0; padding: 20px; }
        .card { background-color: #2d2d2d; padding: 2.5rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); text-align: center; width: 420px; }
        h2 { color: #4CAF50; margin-bottom: 5px; }
        .sub-title { color: #aaa; font-size: 0.9rem; margin-bottom: 25px; }
        
        .section { background: #232323; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #333; text-align: left; }
        .section h3 { font-size: 0.95rem; margin-top: 0; color: #4CAF50; border-bottom: 1px solid #444; padding-bottom: 8px; margin-bottom: 12px; }
        
        label { display: block; font-size: 0.8rem; color: #888; margin-bottom: 5px; }
        input[type="text"] { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #444; background: #111; color: white; box-sizing: border-box; margin-bottom: 10px; font-size: 0.9rem; }
        input[type="file"] { margin: 5px 0 15px 0; width: 100%; color: #bbb; font-size: 0.85rem; }
        
        button { border: none; padding: 12px; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; font-size: 0.95rem; transition: 0.3s; margin-top: 5px; }
        .btn-normal { background-color: #607D8B; color: white; }
        .btn-normal:hover { background-color: #455A64; }
        .btn-auto { background-color: #4CAF50; color: white; }
        .btn-auto:hover { background-color: #45a049; }
        
        #result-container { margin-top: 20px; display: none; padding: 15px; background: #3d3d3d; border-radius: 10px; border: 1px solid #555; }
        #id-display { font-size: 1.4rem; color: #ffd700; font-weight: bold; display: block; margin-bottom: 10px; letter-spacing: 2px; }
        .btn-copy { background-color: #2196F3; color: white; padding: 6px 12px; width: auto; font-size: 0.8rem; }
        
        .status-msg { font-size: 0.8rem; color: #888; margin-top: 15px; }
    </style>
</head>
<body>
    <div class="card">
        <h2>üì± Mine City</h2>
        <p class="sub-title">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏π‡∏õ‡∏ï‡∏¥‡∏î‡∏ö‡∏±‡∏ï‡∏£ [ ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î 1:1 ]</p>
        
        <div class="section">
            <h3>[ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏™‡πà‡∏£‡∏π‡∏õ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å / ‡πÄ‡∏≠‡∏≤‡∏£‡∏´‡∏±‡∏™ ID ]</h3>
            <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå:</label>
            <input type="file" id="fileNormal" accept="image/*">
            <button class="btn-normal" onclick="handleUpload('normal')">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏≤‡∏£‡∏´‡∏±‡∏™ ID</button>
        </div>

        <div class="section">
            <h3>[ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô ]</h3>
            <label>‡πÄ‡∏•‡∏Ç No.ID ‡πÉ‡∏ï‡πâ‡∏ö‡∏±‡∏ï‡∏£ (CitizenID):</label>
            <input type="text" id="userIdInput" placeholder="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: 378901">
            <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏°‡πà:</label>
            <input type="file" id="fileAuto" accept="image/*">
            <button class="btn-auto" onclick="handleUpload('auto')">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏π‡∏õ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏±‡∏ï‡∏£‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</button>
        </div>

        <div id="result-container">
            <span id="id-display">‡∏£‡∏´‡∏±‡∏™‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</span>
            <button class="btn-copy" id="copyBtn" onclick="copyId()">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™</button>
        </div>
        
        <p class="status-msg" id="status-text">Server Status: Online ‚úÖ</p>
    </div>

    <script>
        async function handleUpload(type) {
            const statusText = document.getElementById('status-text');
            const resultContainer = document.getElementById('result-container');
            const idDisplay = document.getElementById('id-display');
            const copyBtn = document.getElementById('copyBtn');
            
            let fileInput = (type === 'normal') ? document.getElementById('fileNormal') : document.getElementById('fileAuto');
            let citizenId = document.getElementById('userIdInput').value;

            if (fileInput.files.length === 0) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö!");
                return;
            }
            if (type === 'auto' && !citizenId) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç No.ID ‡πÉ‡∏ï‡πâ‡∏ö‡∏±‡∏ï‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö!");
                return;
            }

            // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô
            idDisplay.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...";
            resultContainer.style.display = "block";
            copyBtn.style.display = "none";
            statusText.innerText = "‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Mine City API...";

            const formData = new FormData();
            formData.append('image', fileInput.files[0]);
            
            // ‡∏™‡πà‡∏á‡πÄ‡∏•‡∏Ç‡πÉ‡∏ï‡πâ‡∏ö‡∏±‡∏ï‡∏£‡πÑ‡∏õ‡πÉ‡∏´‡πâ Python ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
            if (type === 'auto') {
                formData.append('userId', citizenId.trim()); 
            }

            try {
                const response = await fetch('https://mine-city.onrender.com/upload', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                
                if (response.ok && (data.success || data.id)) {
                    idDisplay.innerText = data.id;
                    copyBtn.style.display = "inline-block";
                    
                    if (type === 'auto') {
                        statusText.innerText = "‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!";
                        alert("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö CitizenID: " + citizenId + " ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
                    } else {
                        statusText.innerText = "‚úÖ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û";
                    }
                } else {
                    statusText.innerText = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + (data.error || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
                    alert("‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + (data.error || "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ"));
                }
            } catch (error) {
                console.error("Fetch Error:", error);
                statusText.innerText = "‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ Server ‡πÑ‡∏î‡πâ";
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Render ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì");
            }
        }

        function copyId() {
            const text = document.getElementById('id-display').innerText;
            navigator.clipboard.writeText(text).then(() => {
                alert("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ " + text + " ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
            });
        }
    </script>
</body>
</html>
